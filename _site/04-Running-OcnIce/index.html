















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-10-19 19:15:21 -0600">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Ocean and Ice Modeling"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  CESM G compset &ndash; Ocean and Ice Modeling
  </title>  

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-Review/index.html">Review</a></li>
            
            
            <li><a href="../02-Ocean-Modeling/index.html">Ocean and Sea Ice Modeling</a></li>
            
            
            <li><a href="../03-Ice-Modeling/index.html">Sea Ice Modeling</a></li>
            
            
            <li><a href="../04-Running-OcnIce/index.html">CESM G compset</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-Ice-Modeling/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Ocean and Ice Modeling</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">CESM G compset</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong>  min
      <br/>
      <strong>Exercises:</strong>  min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How to run Ocean and Ice models?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>We will setup and run 4 ocean/sea-ice experiments to learn how to work with these components.</p>

<p>Ocean/ice active compsets start with <code class="language-plaintext highlighter-rouge">G</code>.</p>

<p>Just like the <code class="language-plaintext highlighter-rouge">F</code> compsets needed SST data as the boundary forcing, <code class="language-plaintext highlighter-rouge">G</code> compsets require boundary forcing from the atmosphere.  The standard atmospheric forcing provided to a <code class="language-plaintext highlighter-rouge">G</code> compset is called CORE (Coordinated Ocean-ice Reference Experiments), version 2, atmopsheric datasets (Large and Yeager 2009)</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">G</code>: this is a standard ocean/ice with data atmosphere/land compset in which the boundary forcing is called <code class="language-plaintext highlighter-rouge">normal year forcing (NYF)</code>, meaning 12 months of CORE forcing data that repeats (think like a climatology).</li>
  <li><code class="language-plaintext highlighter-rouge">GIAF</code>: this is ocean/ice activate with data atmosphere/land in which teh boundary forcing is interannually varying from CORE forcing data.</li>
</ul>

<h2 id="our-experiments">Our Experiments</h2>

<h3 id="control-case-default-settings-1-year__">Control Case: default settings, 1 year__</h3>

<p>Setup, build, and run a control case for 1 year. Use the following:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">compset</code>=<code class="language-plaintext highlighter-rouge">G</code></li>
  <li><code class="language-plaintext highlighter-rouge">resolution</code>=<code class="language-plaintext highlighter-rouge">T62_g37</code></li>
</ul>

<h3 id="overflow-parameterization-case">Overflow Parameterization Case</h3>

<p>Create a case exactly the same as the control case, but with the overflow parameterization turned off.</p>

<p>This means we will not attempt to parameterize the mixing associated with dense water sinking in the Denmark Strait, Faroe Bank Channel, and Weddell and Ross Seas.</p>

<p>Modifying parameterizations is done in the namelists.</p>

<p>After we build the model or run <code class="language-plaintext highlighter-rouge">./preview_namelists</code>, the namelists that the model uses are located in:</p>

<p><code class="language-plaintext highlighter-rouge">/glade/scratch/USERNAME/CASENAME/run/xxx_in</code></p>

<p>Remember, when we want to make a change to a namelists, we use <code class="language-plaintext highlighter-rouge">user_nl_xxx</code> to override the default behavior.
We can always run <code class="language-plaintext highlighter-rouge">./preview_namelists</code> to check our namelists get resolved properly.</p>

<p>To create an exact replica of another case, you can use <code class="language-plaintext highlighter-rouge">create_clone</code> rather than <code class="language-plaintext highlighter-rouge">create_newcase</code>, as follows, replacing <code class="language-plaintext highlighter-rouge">NEWCASE</code> and <code class="language-plaintext highlighter-rouge">OLDCASE</code> with the correct case names:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./create_clone <span class="nt">--case</span> ~/cases/NEWCASE <span class="nt">--clone</span> ~/cases/OLDCASE
</code></pre></div></div>

<p>Setup and build the case.</p>

<p>Modify the <code class="language-plaintext highlighter-rouge">user_nl_pop</code> namelist as follows:</p>

<p><code class="language-plaintext highlighter-rouge">overflows_on = .false.</code></p>

<p><code class="language-plaintext highlighter-rouge">overflows_interactive = .false.</code></p>

<p>Run the case for 1 year.</p>

<blockquote class="challenge">
  <h2 id="where-do-you-expect-the-overflow-parameterization-to-matter">Where do you expect the overflow parameterization to matter?</h2>

  <p>What variables would you look at in your output?</p>

</blockquote>

<h3 id="change-the-snow-albedo-on-sea-ice-case">Change the snow albedo on sea ice case</h3>

<p>Create a clone of your control simulation.</p>

<p>Modify <code class="language-plaintext highlighter-rouge">user_nl_cice</code> as follows:</p>

<p><code class="language-plaintext highlighter-rouge">r_snw = 2.00</code></p>

<p>This is a tuning parameter that specifies the number of standard deviations away from the base optical properties in the shortwave 
radiative transfer code.  The default value is -2.00.  It is used in the equation:  <code class="language-plaintext highlighter-rouge">rsnw_nonmelt = 500 - r_snw * 250</code> (in microns).</p>

<p>Higher values of r_snw -&gt; lower rsnw_nonmelt -&gt; higher albedo.</p>

<p>Run the model for 1-year.</p>

<blockquote class="challenge">
  <h2 id="what-do-you-think-will-happen-by-increasing-the-albedo-of-the-ice">What do you think will happen by increasing the albedo of the ice?</h2>
  <p>How can you check?</p>

  <p>Some variables to look at:</p>

  <p>albedo to convince yourself this worked as expected</p>

  <p>ice fraction to see how changing albedo impacted the ice</p>
</blockquote>

<h3 id="increase-the-zonal-wind-stress-in-the-ocean-case">Increase the zonal wind stress in the ocean case</h3>

<p>Create a clone of your control simulation
Run <code class="language-plaintext highlighter-rouge">case.setup</code></p>

<p>This exercise demonstrates how to change the source code (i.e. Fortran) of the model.  The original source code resides in:</p>

<p><code class="language-plaintext highlighter-rouge">/glade/work/USERNAME/cesm2.1.1/</code></p>

<p>Similar to namelists, we don’t change the original, we make changes in an alternate location, then modify it to override the default.  Changes to source code go in <code class="language-plaintext highlighter-rouge">SourceMods/src.xxx</code></p>

<p>Also, source code changes must be included in the build, so we make the changes before building the model.</p>

<p>Copy the file <code class="language-plaintext highlighter-rouge">/glade/work/USERNAME/cesm2.1.1/components/pop/source/forcing_coupled.F90</code> to <code class="language-plaintext highlighter-rouge">CASEDIR/SourceMods/src.pop/</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /glade/work/USERNAME/cesm2.1.1/components/pop/source/forcing_coupled.F90 ~/cases/gwindstress/SourceModes/src.pop/
</code></pre></div></div>

<p>Now let’s look at the code.</p>

<p>Find the subroutine <code class="language-plaintext highlighter-rouge">rotate_wind_stress</code></p>

<p>This code rotates the wind stress vector to map it onto the correct location in the model local grid coordinates.  We can think of the first component (array index 1) as the zonal direction (on the model grid) and the second component (array index 2) as the meridional component on the model local grid coordinates.<br />
Add a line of code to increase the first component by 25%.</p>

<p>Build and run the model for 1-year.</p>

<p>Be sure to check that the model built successfully before you run it.  If you had a typo, you will likely get a build error and your model will not run because it did not build.</p>

<blockquote class="challenge">
  <h2 id="where-do-you-think-there-will-be-the-biggest-impacts-of-increased-zonal-wind-stress">Where do you think there will be the biggest impacts of increased zonal wind stress?</h2>

  <p>How can you check the impact?</p>

  <p>What variables would you look at?</p>

</blockquote>

<h2 id="looking-at-our-output">Looking at our output</h2>

<p>Once you have submitted your model runs, they will run relatively quickly if the queue is not too busy. In the meantime, you can look at the output of my model runs to explore the results of these experiments.</p>

<p>Experiment 1 (control): <code class="language-plaintext highlighter-rouge">/glade/scratch/kpegion/archive/gcontrol/ocn/hist/</code></p>

<p>Experiment 2 (overflow): <code class="language-plaintext highlighter-rouge">/glade/scratch/kpegion/archive/goverflow/ocn/hist/</code></p>

<p>Experiment 3 (snow albedo): <code class="language-plaintext highlighter-rouge">/glade/scratch/kpegion/archive/gsnowalb/ice/hist</code></p>

<p>Experiment 4 (wind stress): <code class="language-plaintext highlighter-rouge">/glade/scratch/kpegion/archive/gwindstress/ocn/hist</code></p>

<p>How would we read this data?</p>

<p>Login to casper and launch Jupyter</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load python/3.6.8
ncar_pylib 
start-jupyter
</code></pre></div></div>

<p>follow the screen for the rest of the steps.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="n">xr</span>

<span class="n">path</span><span class="o">=</span><span class="s">'/glade/scratch/kpegion/archive/gcontrol/ocn/hist/'</span>
<span class="n">files</span><span class="o">=</span><span class="s">'gcontrol.pop.h.0001-*.nc'</span>
<span class="n">ds</span><span class="o">=</span><span class="n">xr</span><span class="p">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">files</span><span class="p">,</span><span class="n">combine</span><span class="o">=</span><span class="s">'nested'</span><span class="p">,</span>
                    <span class="n">concat_dim</span><span class="o">=</span><span class="s">'time'</span><span class="p">)</span>
<span class="n">ds</span>
</code></pre></div></div>

<p>We can look at annual mean values by taking the mean in time.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_amean</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s">'time'</span><span class="p">)</span>
</code></pre></div></div>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li>
</li>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../03-Ice-Modeling/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 help-links" align="right">
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
